# =============================================================================
# Vibe MCP Configuration Template
# =============================================================================
#
# Copy this file to ~/.config/atlastrinity/vibe_config.toml and customize.
# This configuration controls the Vibe MCP server integration with AtlasTrinity.
#
# Based on official Mistral Vibe documentation:
# https://docs.mistral.ai/mistral-vibe/introduction/configuration
#
# Author: AtlasTrinity Team
# Date: 2026-01-20
# =============================================================================

# -----------------------------------------------------------------------------
# CORE SETTINGS
# -----------------------------------------------------------------------------

# Active model alias (from models list below)
# This is the default model used when no explicit model is specified
active_model = "devstral-2"  # SET THIS: e.g., "devstral-2", "gpt-4o", etc.

# System prompt ID (loads from ~/.vibe/prompts/{id}.md)
# Set to a custom ID to override the default Vibe system prompt
system_prompt_id = "default"

# Default operational mode for AI interactions
# Options: "default" | "plan" | "accept-edits" | "auto-approve"
#   - default: Requires confirmation for tool executions
#   - plan: Read-only mode for exploration (enabled_tools: ["grep", "read_file", "todo"])
#   - accept-edits: Auto-approves file edit tools only
#   - auto-approve: Auto-approves all tool executions
default_mode = "auto-approve"

# Execution limits
max_turns = 10          # Maximum conversation turns (1-100)
max_price = 1.0         # Maximum cost per conversation in USD (optional)
timeout_s = 600.0       # Default timeout in seconds

# -----------------------------------------------------------------------------
# TOOL PATTERNS (Glob / Regex)
# -----------------------------------------------------------------------------
# Control which tools are available using patterns.
# Patterns support:
#   - Glob: "serena_*", "mcp_*"
#   - Regex (prefix with re:): "re:^db_.*$"
#   - Literal: "grep", "bash"

# Enable only specific tools (empty = all enabled by default)
# Example: enabled_tools = ["serena_*", "read_file", "grep"]
enabled_tools = []

# Disable specific tools (takes precedence over enabled)
# Example: disabled_tools = ["mcp_*", "grep"]
disabled_tools = []

# -----------------------------------------------------------------------------
# UI SETTINGS (for CLI mode)
# -----------------------------------------------------------------------------

# Disable the welcome banner animation (recommended for programmatic use)
disable_welcome_banner_animation = true

# Use vim keybindings in TUI
vim_keybindings = false

# Textual theme name (optional)
# textual_theme = "custom_theme"

# -----------------------------------------------------------------------------
# PROVIDERS
# -----------------------------------------------------------------------------
# Define custom LLM providers for Vibe.
# Each provider needs: name, api_base, api_key_env_var, api_style, backend



# Example: Custom OpenAI-compatible endpoint
# [[providers]]
# name = "custom_openai"
# api_base = "https://my-custom-llm.company.com/v1"
# api_key_env_var = "CUSTOM_OPENAI_KEY"
# api_style = "openai"
# backend = "generic"

# Example: Anthropic
# [[providers]]
# name = "anthropic"
# api_base = "https://api.anthropic.com/v1"
# api_key_env_var = "ANTHROPIC_API_KEY"
# api_style = "anthropic"
# backend = "anthropic"

# Mistral Official Provider (Default for devstral models)
[[providers]]
name = "mistral"
api_base = "https://api.mistral.ai/v1"
api_key_env_var = "MISTRAL_API_KEY"
api_style = "mistral"
backend = "mistral"

# Copilot Global Provider (Uses OpenAI-style API)
[[providers]]
name = "copilot"
api_base = "https://api.atlastrinity.ai/v1"  # Or your local proxy
api_key_env_var = "COPILOT_API_KEY"
api_style = "openai"
backend = "generic"

# -----------------------------------------------------------------------------
# MODELS
# -----------------------------------------------------------------------------
# Define available models with pricing and settings.
# Each model needs: name (API ID), provider, alias, temperature

# Define your models below. Example configurations:
#
[[models]]
name = "codestral-latest"       # Often referred to as Devstral/Codestral
provider = "mistral"
alias = "devstral-2"            # User requested alias
temperature = 0.0
input_price = 1.0               # Lower price
output_price = 3.0

# Add your models here - uncomment and configure as needed

# -----------------------------------------------------------------------------
# TOOL PERMISSION OVERRIDES
# -----------------------------------------------------------------------------
# Override default permissions for specific tools.
# Options: "always" | "ask" | "never"

[tools.bash]
permission = "ask"

[tools.write_file]
permission = "ask"

[tools.read_file]
permission = "always"

[tools.grep]
permission = "always"

[tools.search_replace]
permission = "ask"

# MCP tool permissions (named as {server_name}_{tool_name})
# Example for fetch server:
# [tools.fetch_server_get]
# permission = "always"

# -----------------------------------------------------------------------------
# MCP SERVER INTEGRATIONS
# -----------------------------------------------------------------------------
# Extend Vibe's capabilities with MCP servers.
# Supported transports: "http" | "streamable-http" | "stdio"

# Example: HTTP server
# [[mcp_servers]]
# name = "my_http_server"
# transport = "http"
# url = "http://localhost:8000"
# headers = { "Authorization" = "Bearer my_token" }
# api_key_env = "MY_API_KEY_ENV_VAR"
# api_key_header = "Authorization"
# api_key_format = "Bearer {token}"

# Example: Streamable HTTP server
# [[mcp_servers]]
# name = "my_streamable_server"
# transport = "streamable-http"
# url = "http://localhost:8001"
# headers = { "X-API-Key" = "my_api_key" }

# Example: Stdio server (local process)
# [[mcp_servers]]
# name = "fetch_server"
# transport = "stdio"
# command = "uvx"
# args = ["mcp-server-fetch"]

# Xcode Build & Test server (iOS/macOS)
# NOTE: Vibe CLI requires ABSOLUTE paths. Replace ${PROJECT_ROOT} manually or via script.
[[mcp_servers]]
name = "xcodebuild"
transport = "stdio"
command = "/usr/local/bin/node"  # Verify node path
args = ["${PROJECT_ROOT}/vendor/XcodeBuildMCP/.smithery/stdio/index.cjs"]

# DevTools (Linter & Analysis)
# NOTE: Uses /bin/sh wrapper to safely set PYTHONPATH, ensuring module discovery works in CLI context
[[mcp_servers]]
name = "devtools"
transport = "stdio"
command = "/bin/sh"
args = ["-c", "export PYTHONPATH=${PROJECT_ROOT} && ${PROJECT_ROOT}/.venv/bin/python3 -m src.mcp_server.devtools_server"]

# -----------------------------------------------------------------------------
# PATHS (Optional)
# -----------------------------------------------------------------------------
# Override default paths. Use ${HOME}, ${CONFIG_ROOT}, ${PROJECT_ROOT} placeholders.

# Custom VIBE_HOME directory (default: ~/.vibe)
vibe_home = "${CONFIG_ROOT}/vibe"

# Custom workspace directory for Vibe operations
# workspace = "${CONFIG_ROOT}/vibe_workspace"

# Custom agents directory (default: ~/.vibe/agents)
agents_dir = "${CONFIG_ROOT}/vibe/agents"

# Custom prompts directory (default: ~/.vibe/prompts)
prompts_dir = "${CONFIG_ROOT}/vibe/prompts"
