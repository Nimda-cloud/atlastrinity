
<!-- AUTO-UPDATED: 2026-02-04T03:10:42.073890 -->
<!-- Modified: .agent/docs/mcp_architecture_diagram.md, src/brain/data/architecture_diagrams/mcp_architecture.md -->


<!-- AUTO-UPDATED: 2026-02-04T03:01:54.839765 -->
<!-- Modified: .agent/docs/mcp_architecture_diagram.md, src/brain/data/architecture_diagrams/mcp_architecture.md, src/renderer/components/MapView.tsx -->


<!-- AUTO-UPDATED: 2026-02-04T02:56:25.745688 -->
<!-- Modified: .agent/docs/mcp_architecture_diagram.md, src/brain/data/architecture_diagrams/mcp_architecture.md -->


<!-- AUTO-UPDATED: 2026-02-04T02:51:57.445621 -->
<!-- Modified: .agent/docs/mcp_architecture_diagram.md, src/brain/data/architecture_diagrams/mcp_architecture.md, src/renderer/components/MapView.tsx -->


<!-- AUTO-UPDATED: 2026-02-04T02:33:19.798884 -->
<!-- Modified: .agent/docs/mcp_architecture_diagram.md, lefthook.yml, package.json -->


<!-- AUTO-UPDATED: 2026-02-04T02:19:44.611049 -->
<!-- Modified: src/main/main.ts, src/renderer/App.tsx, src/renderer/components/MapView.tsx -->


<!-- AUTO-UPDATED: 2026-02-04T01:58:29.559057 -->
<!-- Modified: scripts/setup_dev.py, scripts/setup_maps_quick.py, src/brain/voice/stt.py -->


<!-- AUTO-UPDATED: 2026-02-03T23:29:48.715013 -->
<!-- Modified: .agent/docs/mcp_architecture_diagram.md, src/brain/data/architecture_diagrams/mcp_architecture.md, src/renderer/components/MapView.tsx -->


<!-- AUTO-UPDATED: 2026-02-03T23:28:55.013466 -->
<!-- Modified: .agent/docs/mcp_architecture_diagram.md, .secrets.baseline, scripts/clean_main.py -->


<!-- AUTO-UPDATED: 2026-02-03T23:27:15.401919 -->
<!-- Modified: .agent/docs/mcp_architecture_diagram.md, .githuworkflows/auto-dependency-fix.yml, .githuworkflows/ci-core.yml -->


<!-- AUTO-UPDATED: 2026-02-03T22:29:59.298718 -->
<!-- Modified: .agent/docs/mcp_architecture_diagram.md, .secrets.baseline, scripts/auto_fix.py -->


<!-- AUTO-UPDATED: 2026-02-03T22:20:50.303223 -->
<!-- Modified: .agent/docs/mcp_architecture_diagram.md, scripts/update_diagrams_mcp.py, src/brain/data/architecture_diagrams/mcp_architecture.md -->


<!-- AUTO-UPDATED: 2026-02-03T22:19:26.982346 -->
<!-- Modified: .agent/docs/mcp_architecture_diagram.md, scripts/update_diagrams_mcp.py, src/brain/data/architecture_diagrams/mcp_architecture.md -->


<!-- AUTO-UPDATED: 2026-02-03T22:19:16.433689 -->
<!-- Modified: .agent/docs/mcp_architecture_diagram.md, .secrets.baseline, lefthook.yml -->


<!-- AUTO-UPDATED: 2026-02-03T22:18:54.436363 -->
<!-- Modified: .agent/docs/mcp_architecture_diagram.md, .secrets.baseline, lefthook.yml -->


<!-- AUTO-UPDATED: 2026-02-03T22:18:29.471955 -->
<!-- Modified: .agent/docs/mcp_architecture_diagram.md, .secrets.baseline, lefthook.yml -->


<!-- AUTO-UPDATED: 2026-02-03T22:13:19.725428 -->
<!-- Modified: .agent/docs/mcp_architecture_diagram.md, .secrets.baseline, scripts/check_mcp_health.py -->


<!-- AUTO-UPDATED: 2026-02-03T22:12:47.959047 -->
<!-- Modified: .agent/docs/mcp_architecture_diagram.md, .secrets.baseline, scripts/check_mcp_health.py -->


<!-- AUTO-UPDATED: 2026-02-03T22:06:26.225089 -->
<!-- Modified: .githuworkflows/ci-core.yml -->


<!-- AUTO-UPDATED: 2026-02-03T22:05:59.397486 -->
<!-- Modified: .githuworkflows/ci-core.yml -->


<!-- AUTO-UPDATED: 2026-02-03T22:01:31.150887 -->
<!-- Modified: .agent/docs/mcp_architecture_diagram.md, .githuworkflows/ci-core.yml, lefthook.yml -->


<!-- AUTO-UPDATED: 2026-02-03T21:45:35.683133 -->
<!-- Modified: .secrets.baseline, lefthook.yml, pyproject.toml -->


<!-- AUTO-UPDATED: 2026-02-03T21:45:29.622861 -->
<!-- Modified: .secrets.baseline, lefthook.yml, pyproject.toml -->


<!-- AUTO-UPDATED: 2026-02-03T21:06:41.430815 -->
<!-- Modified: scripts/mcp_sandbox.py -->


<!-- AUTO-UPDATED: 2026-02-03T21:04:52.231084 -->
<!-- Modified: scripts/mcp_sandbox.py -->


<!-- AUTO-UPDATED: 2026-02-03T20:59:01.363225 -->
<!-- Modified: scripts/mcp_sandbox.py -->


<!-- AUTO-UPDATED: 2026-02-03T20:58:14.063082 -->
<!-- Modified: scripts/mcp_sandbox.py -->


<!-- AUTO-UPDATED: 2026-02-03T20:56:47.940745 -->
<!-- Modified: scripts/mcp_sandbox.py -->


<!-- AUTO-UPDATED: 2026-02-03T20:56:02.798815 -->
<!-- Modified: scripts/mcp_sandbox.py -->


<!-- AUTO-UPDATED: 2026-02-03T20:53:01.246058 -->
<!-- Modified: scripts/mcp_sandbox.py -->


<!-- AUTO-UPDATED: 2026-02-03T20:52:23.635556 -->
<!-- Modified: scripts/mcp_sandbox.py -->


<!-- AUTO-UPDATED: 2026-02-03T20:51:47.056170 -->
<!-- Modified: scripts/mcp_sandbox.py -->


<!-- AUTO-UPDATED: 2026-02-03T20:51:12.941060 -->
<!-- Modified: scripts/mcp_sandbox.py -->


<!-- AUTO-UPDATED: 2026-02-03T20:47:10.149206 -->
<!-- Modified: scripts/mcp_sandbox.py -->


<!-- AUTO-UPDATED: 2026-02-03T20:38:02.027566 -->
<!-- Modified: scripts/mcp_sandbox.py -->


<!-- AUTO-UPDATED: 2026-02-03T20:36:38.350099 -->
<!-- Modified: scripts/mcp_sandbox.py -->


<!-- AUTO-UPDATED: 2026-02-03T20:35:55.875406 -->
<!-- Modified: scripts/mcp_sandbox.py -->


<!-- AUTO-UPDATED: 2026-02-03T20:34:38.105039 -->
<!-- Modified: scripts/mcp_sandbox.py -->


<!-- AUTO-UPDATED: 2026-02-03T20:33:23.585484 -->
<!-- Modified: scripts/mcp_sandbox.py -->


<!-- AUTO-UPDATED: 2026-02-03T20:28:20.446134 -->
<!-- Modified: scripts/mcp_sandbox.py -->


<!-- AUTO-UPDATED: 2026-02-03T20:26:25.126979 -->
<!-- Modified: scripts/mcp_sandbox.py -->


<!-- AUTO-UPDATED: 2026-02-03T20:24:42.024002 -->
<!-- Modified: scripts/mcp_sandbox.py -->


<!-- AUTO-UPDATED: 2026-02-03T20:21:42.224060 -->
<!-- Modified: scripts/mcp_sandbox.py -->


<!-- AUTO-UPDATED: 2026-02-03T20:20:17.503516 -->
<!-- Modified: scripts/mcp_sandbox.py -->


<!-- AUTO-UPDATED: 2026-02-03T20:18:52.853697 -->
<!-- Modified: scripts/mcp_sandbox.py -->


<!-- AUTO-UPDATED: 2026-02-03T20:10:20.924194 -->
<!-- Modified: scripts/mcp_sandbox.py -->


<!-- AUTO-UPDATED: 2026-02-03T20:04:42.819210 -->
<!-- Modified: scripts/mcp_sandbox.py -->


<!-- AUTO-UPDATED: 2026-02-03T20:04:12.484811 -->
<!-- Modified: scripts/mcp_sandbox.py -->


<!-- AUTO-UPDATED: 2026-02-03T20:02:44.049459 -->
<!-- Modified: scripts/mcp_sandbox.py -->


<!-- AUTO-UPDATED: 2026-02-03T13:19:48.678367 -->
<!-- Modified: src/renderer/components/CommandLine.tsx -->


<!-- AUTO-UPDATED: 2026-02-03T13:17:40.220880 -->
<!-- Modified: src/renderer/components/CommandLine.tsx -->


<!-- AUTO-UPDATED: 2026-02-03T13:09:43.397020 -->
<!-- Modified: src/renderer/components/CommandLine.tsx -->


<!-- AUTO-UPDATED: 2026-02-03T12:07:09.340098 -->
<!-- Modified: .agent/docs/mcp_architecture_diagram.md, config/vibe_config.toml.template, src/brain/constraint_monitor.py -->


<!-- AUTO-UPDATED: 2026-02-03T11:57:10.589344 -->
<!-- Modified: .agent/docs/mcp_architecture_diagram.md, config/vibe_config.toml.template, src/brain/agents/grisha.py -->


<!-- AUTO-UPDATED: 2026-02-03T10:17:44.111482 -->
<!-- Modified: src/mcp_server/vibe_server.py -->


<!-- AUTO-UPDATED: 2026-02-02T23:12:03.657455 -->
<!-- Modified: .agent/plans/fix_tetyana_grisha_sync.md, .secrets.baseline, src/brain/agents/grisha.py -->


<!-- AUTO-UPDATED: 2026-02-02T20:30:16.195837 -->
<!-- Modified: src/mcp_server/vibe_config.py -->


<!-- AUTO-UPDATED: 2026-02-02T20:08:57.503952 -->
<!-- Modified: .secrets.baseline, src/mcp_server/vibe_server.py -->


<!-- AUTO-UPDATED: 2026-02-02T13:01:47.784040 -->
<!-- Modified: src/brain/monitoring.py -->


<!-- AUTO-UPDATED: 2026-02-02T13:00:05.271311 -->
<!-- Modified: src/brain/monitoring.py -->


<!-- AUTO-UPDATED: 2026-02-02T10:22:08.626528 -->
<!-- Modified: src/brain/monitoring.py, src/brain/parallel_healing.py, tests/test_parallel_healing_integration.py -->


<!-- AUTO-UPDATED: 2026-01-29T19:26:02.991706 -->
<!-- Modified: .docs/model_usage_policy.md, config/vibe_config.toml.template -->


<!-- AUTO-UPDATED: 2026-01-26T13:08:42.672198 -->
<!-- Modified: .agent/docs/mcp_architecture_diagram.md, .agent/docs/mcp_servers_setup_analysis.md, .agent/workflows/diagrams.md -->


<!-- AUTO-UPDATED: 2026-01-26T12:46:38.397517 -->
<!-- Modified: .agent/docs/mcp_architecture_diagram.md, .agent/docs/mcp_servers_setup_analysis.md, .agent/docs/mcp_tools_analysis.md -->


<!-- AUTO-UPDATED: 2026-01-26T12:38:17.869403 -->
<!-- Modified: .agent/docs/mcp_servers_setup_analysis.md, .agent/docs/mcp_tools_analysis.md, config/README.md -->

# MCP Servers Architecture v4.7 - Visual Diagram

> **Auto-rendered**: This diagram automatically renders in GitHub, VSCode (with Mermaid extension), and other Markdown viewers.

## Complete Execution Flow

```mermaid
flowchart TD
    Start([User Request]) --> Intent[Intent Detection<br/>behavior_engine.py]
    
    Intent --> |simple_chat| Direct[Direct Response]
    Intent --> |info_query| Route[Tool Routing]
    Intent --> |complex_task| Route
    
    Route --> Synonym[Synonym Resolution<br/>tool_dispatcher.py]
    Synonym --> Server[Server Selection<br/>behavior_config.yaml]
    Server --> Schema[Schema Lookup üÜï<br/>mcp_registry.py<br/>CACHED]
    
    Schema --> Validate{Validation}
    Validate --> |missing args| AutoFill[Auto-fill Arguments üÜï<br/>query ‚Üê question<br/>prompt ‚Üê query]
    AutoFill --> Validate
    
    Validate --> |valid| Convert[Type Conversion üÜï<br/>str/int/float/bool<br/>list: JSON + comma<br/>dict: JSON]
    Validate --> |invalid| Error1[Return Error]
    
    Convert --> Metrics1[Start Metrics üÜï<br/>Track start time]
    Metrics1 --> Session[Get/Create Session<br/>mcp_manager.py]
    
    Session --> |connected| Execute[MCP Protocol Call<br/>session.call_tool]
    Session --> |failed| Retry{Connection<br/>Error?}
    
    Execute --> |success| Metrics2[Track Duration üÜï<br/>Log if >5s]
    Execute --> |error| ErrorHandle{Error Type}
    
    ErrorHandle --> |connection| Backoff[Exponential Backoff üÜï<br/>Retry 1: 0.5s<br/>Retry 2: 1.0s]
    Backoff --> Cleanup[Session Cleanup üÜï]
    Cleanup --> Session
    
    ErrorHandle --> |other| Error2[Detailed Error üÜï<br/>server, tool, context]
    
    Metrics2 --> Result[Return Result]
    Error1 --> Result
    Error2 --> Result
    Direct --> Result
    Result --> End([Agent Processing])
    
    style Intent fill:#e1f5ff
    style Schema fill:#fff4e1
    style AutoFill fill:#e1ffe1
    style Convert fill:#e1ffe1
    style Metrics1 fill:#ffe1f5
    style Metrics2 fill:#ffe1f5
    style Backoff fill:#ffe1e1
    style Cleanup fill:#ffe1e1
```

## Phase 1: Intent Detection

```mermaid
graph LR
    subgraph "behavior_engine.py"
        A[Load Config] --> B[Parse Keywords]
        B --> C{Match Intent}
        C --> |chat| D[simple_chat]
        C --> |query| E[info_query]
        C --> |task| F[complex_task]
    end
    
    G[behavior_config.yaml] -.->|rules| A
    
    style A fill:#e1f5ff
    style B fill:#e1f5ff
    style C fill:#e1f5ff
```

## Phase 2: Tool Routing & Validation

```mermaid
graph TB
    subgraph "tool_dispatcher.py"
        A[Tool Name] --> B[Synonym Map]
        B --> C[Server Selection]
        C --> D[Schema Lookup]
        D --> E{Has Schema?}
        E --> |yes| F[Validate Args]
        E --> |no| G[Pass Through]
        F --> H{Missing Args?}
        H --> |yes| I[Auto-fill üÜï<br/>query/prompt]
        H --> |no| J[Type Convert üÜï]
        I --> K{Still Missing?}
        K --> |yes| L[Error]
        K --> |no| J
        J --> M[Ready for Execution]
    end
    
    N[mcp_registry.py<br/>Cache üÜï] -.->|cached lookup| D
    O[tool_schemas.json] -.->|schema data| D
    
    style I fill:#e1ffe1
    style J fill:#e1ffe1
    style N fill:#fff4e1
```

## Phase 3: Tool Execution with Resilience

```mermaid
sequenceDiagram
    participant D as Dispatcher
    participant M as MCPManager
    participant S as Session
    participant Server as MCP Server
    
    D->>M: call_tool(server, tool, args)
    activate M
    M->>M: Start Metrics üÜï
    M->>S: get_session(server)
    
    alt Session Exists
        S-->>M: Return session
    else No Session
        S->>Server: Connect
        Server-->>S: Connection OK
        S-->>M: New session
    end
    
    M->>Server: call_tool(tool, args)
    
    alt Success
        Server-->>M: Result
        M->>M: Track Duration üÜï
        M-->>D: Return result
    else Connection Error
        Server--xM: Connection Lost
        M->>M: Cleanup Session üÜï
        M->>M: Wait 0.5s (Retry 1) üÜï
        M->>Server: Reconnect
        
        alt Retry Success
            Server-->>M: Result
            M-->>D: Return result
        else Retry Failed
            M->>M: Wait 1.0s (Retry 2) üÜï
            M->>Server: Reconnect
            
            alt Final Success
                Server-->>M: Result
                M-->>D: Return result
            else All Failed
                M-->>D: Error (retries exhausted) üÜï
            end
        end
    else Other Error
        Server--xM: Error
        M-->>D: Detailed Error üÜï
    end
    deactivate M
```

## Phase 4: Registry & Caching System

```mermaid
graph TB
    subgraph "mcp_registry.py"
        A[get_tool_schema] --> B{In Cache?}
        B --> |hit üÜï| C[Return Cached]
        B --> |miss üÜï| D[Load from JSON]
        D --> E[Update Cache üÜï]
        E --> F[Return Schema]
        
        G[get_server_for_tool] --> H{In Cache?}
        H --> |hit üÜï| I[Return Cached]
        H --> |miss üÜï| J[Lookup Server]
        J --> K[Update Cache üÜï]
        K --> L[Return Server]
    end
    
    M[tool_schemas.json] -.->|load| D
    M -.->|load| J
    
    N[Cache Stats üÜï<br/>get_registry_stats] -.->|monitor| B
    N -.->|monitor| H
    
    style B fill:#fff4e1
    style E fill:#fff4e1
    style H fill:#fff4e1
    style K fill:#fff4e1
    style N fill:#ffe1f5
```

## Component Architecture

```mermaid
C4Context
    title MCP Servers Architecture - Component View
    
    Person(user, "User", "Sends requests")
    
    System_Boundary(trinity, "AtlasTrinity") {
        Container(behavior, "BehaviorEngine", "Python", "Intent detection<br/>Strategy selection")
        Container(dispatcher, "ToolDispatcher", "Python", "Tool routing<br/>Validation üÜï<br/>Auto-fill üÜï")
        Container(registry, "MCPRegistry", "Python", "Schema storage<br/>Caching üÜï")
        Container(manager, "MCPManager", "Python", "Session mgmt<br/>Resilience üÜï")
        
        ContainerDb(schemas, "Schemas", "JSON", "tool_schemas.json<br/>mcp_catalog.json")
        ContainerDb(config, "Config", "YAML", "behavior_config.yaml<br/>mcp_servers.json")
    }
    
    System_Ext(mcp1, "macos-use", "GUI automation")
    System_Ext(mcp2, "filesystem", "File operations")
    System_Ext(mcp3, "puppeteer", "Browser control")
    System_Ext(mcp4, "memory", "Knowledge graph")
    System_Ext(mcp_more, "13 more servers...", "Various capabilities")
    
    Rel(user, behavior, "Request")
    Rel(behavior, dispatcher, "Route tool")
    Rel(dispatcher, registry, "Get schema (cached üÜï)")
    Rel(dispatcher, manager, "Execute tool")
    Rel(manager, mcp1, "MCP Protocol")
    Rel(manager, mcp2, "MCP Protocol")
    Rel(manager, mcp3, "MCP Protocol")
    Rel(manager, mcp4, "MCP Protocol")
    Rel(manager, mcp_more, "MCP Protocol")
    
    Rel(registry, schemas, "Load")
    Rel(behavior, config, "Load")
    Rel(dispatcher, config, "Load")
    Rel(manager, config, "Load")
```

## Performance Metrics Flow

```mermaid
graph LR
    subgraph "Monitoring üÜï"
        A[Tool Call Start] --> B[Record Start Time]
        B --> C[Execute]
        C --> D[Record End Time]
        D --> E{Duration > 5s?}
        E --> |yes| F[Log Slow Call]
        E --> |no| G[Track Metrics]
        
        H[Cache Access] --> I{Hit or Miss?}
        I --> |hit| J[Increment Hits]
        I --> |miss| K[Increment Misses]
        
        L[Connection Error] --> M[Increment Retries]
        M --> N{Max Retries?}
        N --> |yes| O[Log Exhausted]
        N --> |no| P[Backoff & Retry]
    end
    
    style F fill:#ffe1e1
    style J fill:#e1ffe1
    style K fill:#ffe1e1
    style O fill:#ffe1e1
```

## Data Flow: Example Request

```mermaid
sequenceDiagram
    autonumber
    participant U as User
    participant B as BehaviorEngine
    participant D as ToolDispatcher
    participant R as MCPRegistry
    participant M as MCPManager
    participant FS as filesystem

    U->>B: "–ó–Ω–∞–π–¥–∏ config.yaml"
    B->>B: Classify: info_query
    B->>D: Route tool
    D->>D: Map "–∑–Ω–∞–π–¥–∏" ‚Üí "find_file"
    D->>R: get_tool_schema("find_file") üÜï
    
    alt Cache Hit üÜï
        R-->>D: Schema (cached)
    else Cache Miss
        R->>R: Load from JSON
        R->>R: Update cache üÜï
        R-->>D: Schema
    end
    
    D->>D: Validate args
    D->>D: Missing: pattern ‚ùå
    D-->>U: Error: Missing required arg
    
    U->>D: "–ó–Ω–∞–π–¥–∏ config.yaml –≤ –ø–æ—Ç–æ—á–Ω—ñ–π –ø–∞–ø—Ü—ñ"
    D->>D: Validate: ‚úì
    D->>D: Convert types üÜï
    D->>M: Execute(filesystem, find_file, args)
    
    M->>M: Start metrics üÜï
    M->>FS: call_tool(find_file, args)
    FS-->>M: [results]
    M->>M: Track duration: 0.3s üÜï
    M-->>U: Result
```

---

## How to Use This Diagram

### üì± Quick Preview (macOS)
```bash
# –í—ñ–¥–∫—Ä–∏—Ç–∏ —Ñ–∞–π–ª —É –¥–µ—Ñ–æ–ª—Ç–Ω–æ–º—É Markdown viewer
npm run diagram:preview
```
**–î–ª—è VSCode:** –í—Å—Ç–∞–Ω–æ–≤–∏ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è **Markdown Preview Mermaid Support**

### üñºÔ∏è Export as Image
```bash
# –ï–∫—Å–ø–æ—Ä—Ç —É PNG (—Ç–µ–º–Ω–∞ —Ç–µ–º–∞, –ø—Ä–æ–∑–æ—Ä–∏–π —Ñ–æ–Ω)
npm run diagram:export

# –ï–∫—Å–ø–æ—Ä—Ç —É PNG + SVG
npm run diagram:export:all
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** `.agent/docs/diagrams/mcp_architecture.png`

### üåê View on GitHub
- Push to GitHub
- Open this file in browser
- Mermaid renders automatically ‚ú®

### üîÑ Update Process (Automated via MCP devtools)
**‚úÖ –ê–í–¢–û–ú–ê–¢–ò–ó–û–í–ê–ù–û:** –î—ñ–∞–≥—Ä–∞–º–∏ –æ–Ω–æ–≤–ª—é—é—Ç—å—Å—è —á–µ—Ä–µ–∑ MCP devtools tool!

#### Automatic Update (Recommended)
```bash
# –ß–µ—Ä–µ–∑ MCP devtools tool (agent access)
# Atlas/Tetyana/Grisha –º–æ–∂—É—Ç—å –≤–∏–∫–ª–∏–∫–∞—Ç–∏:
devtools_update_architecture_diagrams(
  target_mode="internal",
  commits_back=1
)

# –ê–±–æ —á–µ—Ä–µ–∑ npm script
npm run diagram:update
```

**–©–æ —Ä–æ–±–∏—Ç—å automatic update:**
1. –ê–Ω–∞–ª—ñ–∑—É—î git diff –æ—Å—Ç–∞–Ω–Ω—ñ—Ö commits
2. –í–∏—è–≤–ª—è—î –∑–º—ñ–Ω–µ–Ω—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ (tool_dispatcher, mcp_manager, etc.)
3. –î–æ–¥–∞—î AUTO-UPDATE markers –∑ timestamp
4. **–û–Ω–æ–≤–ª—é—î –û–ë–ê —Ñ–∞–π–ª–∏ –æ–¥–Ω–æ—á–∞—Å–Ω–æ:**
   - `.agent/docs/mcp_architecture_diagram.md` (—Ü–µ–π —Ñ–∞–π–ª)
   - `src/brain/data/architecture_diagrams/mcp_architecture.md` (sync –∫–æ–ø—ñ—è)
5. –ï–∫—Å–ø–æ—Ä—Ç—É—î PNG/SVG –≤ `exports/`

**Self-healing integration:**
- –ü—Ä–∏ —Å–∞–º–æ–ª—ñ–∫—É–≤–∞–Ω–Ω—ñ Vibe –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Ç—Ä–∏–≥–µ—Ä–∏—Ç—å update –ø—ñ—Å–ª—è —Ñ—ñ–∫—Å—É
- Grisha –≤–µ—Ä–∏—Ñ—ñ–∫—É—î –ø–µ—Ä–µ–¥ commit
- –î—ñ–∞–≥—Ä–∞–º–∏ –∑–∞–≤–∂–¥–∏ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–æ–≤–∞–Ω—ñ –∑ –∫–æ–¥–æ–º

#### Manual Update (—è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ)
1. **Code changes** ‚Üí –†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –¥—ñ–∞–≥—Ä–∞–º—É –≤—Ä—É—á–Ω—É
2. **Update diagram** ‚Üí –ó–º—ñ–Ω–∏—Ç–∏ Mermaid –∫–æ–¥ –≤ —Ü—å–æ–º—É —Ñ–∞–π–ª—ñ
3. **Sync** ‚Üí –ó–∞–ø—É—Å—Ç–∏—Ç–∏ `devtools_update_architecture_diagrams` –¥–ª—è sync –≤ –æ–±–∏–¥–≤–∞ —Ñ–∞–π–ª–∏
4. **Export** ‚Üí `npm run diagram:export` (optional)

---

## Diagram Legend

| Symbol | Meaning |
|--------|---------|
| üÜï | New in v4.7 |
| ‚úì | Success path |
| ‚ùå | Error path |
| üìä | Metrics/monitoring |
| üîÑ | Retry logic |

---

**Last Updated:** 2026-01-26 (v4.7)  
**Auto-updates via:** `devtools_update_architecture_diagrams` (MCP tool)  
**Dual-location sync:** `.agent/docs/` ‚Üî `src/brain/data/architecture_diagrams/`  
**Self-healing enabled:** Vibe triggers update post-fix with Grisha verification
