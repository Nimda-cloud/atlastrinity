# Lefthook configuration for modernized local CI
# Run all linters: npx lefthook run lint:all

lint:all:
  parallel: true
  commands:
    # === TypeScript / JavaScript ===
    01-biome:
      run: npx @biomejs/biome check --write src scripts
    02-oxlint:
      run: npx oxlint src scripts --deny-warnings --fix
    03-tsc:
      run: npx tsc --noEmit -p tsconfig.json && npx tsc --noEmit -p tsconfig.main.json
    04-eslint-typed:
      run: npx eslint src/main src/renderer
    # === Python ===
    05-ruff:
      run: .venv/bin/ruff check . --fix && .venv/bin/ruff format .
    06-pyright:
      run: npx pyright src scripts
    07-pyrefly:
      run: |
        echo "ℹ️  Pyrefly skipped: Import resolution incompatible with src.brain.* structure"
        echo "   ✓ Pyright (06-pyright) provides comprehensive type checking"
        exit 0
    08-complexity:
      run: .venv/bin/xenon --max-absolute F --max-modules D --max-average C -i testing,maintenance,integrations src
    09-bandit:
      run: .venv/bin/bandit -c pyproject.toml -r src
    10-vulture:
      run: .venv/bin/vulture src scripts vulture_whitelist.py --min-confidence 95 --exclude .venv,dist_venv,node_modules,__pycache__
    # === Cross-language ===
    11-knip:
      run: npx knip
    12-security:
      run: npm run lint:security
    13-yaml-sync:
      run: .venv/bin/python src/maintenance/config_sync.py

pre-commit:
  parallel: false
  commands:
    diagrams:
      run: npm run diagram:auto-update && git add src/brain/data/architecture_diagrams/mcp_architecture.md .agent/docs/mcp_architecture_diagram.md

pre-push:
  parallel: true
  commands:
    checks:
      run: npx lefthook run lint:all
