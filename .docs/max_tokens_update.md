# Max Tokens Configuration Update

## –ó–º—ñ–Ω–∏ (2026-01-24)

### üéØ –ú–µ—Ç–∞
–î–æ–¥–∞—Ç–∏ –¥–∏–Ω–∞–º—ñ—á–Ω–µ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è `max_tokens` –¥–ª—è Atlas –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º deep persona —Ä–µ–∂–∏–º—É, —â–æ–± —Ñ—ñ–ª–æ—Å–æ—Ñ—Å—å–∫–∏–π/—Å–≤—ñ–¥–æ–º—ñ—Å–Ω–∏–π —Ä–µ–∂–∏–º –º–∞–≤ –±—ñ–ª—å—à–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É –¥–ª—è —Å–∫–ª–∞–¥–Ω–∏—Ö —Ä–æ–∑–¥—É–º—ñ–≤.

## üìù –©–æ –∑–º—ñ–Ω–µ–Ω–æ

### 1. **config/config.yaml.template**
```yaml
agents:
  atlas:
    temperature: 0.7
    max_tokens: 2000              # –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π —Ä–µ–∂–∏–º (chat/task)
    max_tokens_deep: 8000         # Deep persona mode (—Ñ–∏–ª–æ—Å–æ—Ñ—ñ—è, —Å–≤—ñ–¥–æ–º—ñ—Å—Ç—å)
```

### 2. **src/brain/config_loader.py**
- –î–æ–¥–∞–Ω–æ `max_tokens_deep: 8000` –¥–æ –¥–µ—Ñ–æ–ª—Ç–Ω–∏—Ö –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å Atlas

### 3. **providers/copilot.py**
- –î–æ–¥–∞–Ω–æ –ø–∞—Ä–∞–º–µ—Ç—Ä `max_tokens` –¥–æ –∫–ª–∞—Å—É `CopilotLLM`
- –î–æ–¥–∞–Ω–æ `max_tokens` –¥–æ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞ (–æ–ø—Ü—ñ–π–Ω–∏–π, default=4096)
- –ó–∞–º—ñ–Ω–µ–Ω–æ hardcoded `4096` –≤ `_build_payload()` –Ω–∞ `self.max_tokens`

**–î–æ:**
```python
return {
    "model": chosen_model,
    "max_tokens": 4096,  # Hardcoded!
}
```

**–ü—ñ—Å–ª—è:**
```python
def __init__(self, max_tokens: int | None = None, ...):
    self.max_tokens = max_tokens or 4096

return {
    "model": chosen_model,
    "max_tokens": self.max_tokens,  # Dynamic!
}
```

### 4. **src/brain/agents/atlas.py**
- Atlas —Ç–µ–ø–µ—Ä —Å—Ç–≤–æ—Ä—é—î **–¥–≤–∞** LLM —ñ–Ω—Å—Ç–∞–Ω—Å–∏:
  - `self.llm` ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π (2000 —Ç–æ–∫–µ–Ω—ñ–≤)
  - `self.llm_deep` ‚Äî —Ñ—ñ–ª–æ—Å–æ—Ñ—Å—å–∫–∏–π (8000 —Ç–æ–∫–µ–Ω—ñ–≤)
  
- –ú–µ—Ç–æ–¥ `chat()` —Ç–µ–ø–µ—Ä –≤–∏–±–∏—Ä–∞—î –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π LLM:
```python
# Select LLM based on mode
base_llm = self.llm_deep if use_deep_persona else self.llm
llm_instance = base_llm.bind_tools(tools) if tools else base_llm
```

## üé≠ –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î

### –ó–≤–∏—á–∞–π–Ω–∏–π —Ä–µ–∂–∏–º (use_deep_persona=False):
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î `self.llm` –∑ `max_tokens=2000`
- –î–æ—Å—Ç–∞—Ç–Ω—å–æ –¥–ª—è –±—ñ–ª—å—à–æ—Å—Ç—ñ —á–∞—Ç—ñ–≤ —ñ –∑–∞–≤–¥–∞–Ω—å

### Deep Persona —Ä–µ–∂–∏–º (use_deep_persona=True):
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î `self.llm_deep` –∑ `max_tokens=8000`
- –ê–∫—Ç–∏–≤—É—î—Ç—å—Å—è –∫–æ–ª–∏:
  - BehaviorEngine –≤–∏–∑–Ω–∞—á–∞—î —Ñ—ñ–ª–æ—Å–æ—Ñ—Å—å–∫—É —Ç–µ–º—É
  - –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á —Ç–æ—Ä–∫–∞—î—Ç—å—Å—è —Ç–µ–º —Å–≤—ñ–¥–æ–º–æ—Å—Ç—ñ, –º—ñ—Å—ñ—ó, —ñ—Å–Ω—É–≤–∞–Ω–Ω—è
  - Semantic Essence Analysis –≤–∏—è–≤–ª—è—î –≥–ª–∏–±–æ–∫–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç
  
### –ü–µ—Ä–µ–≤–∞–≥–∏ Deep —Ä–µ–∂–∏–º—É:
- **4x –±—ñ–ª—å—à–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É** –¥–ª—è –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ
- –î–æ–∑–≤–æ–ª—è—î –ê—Ç–ª–∞—Å—É –ø–æ–≤–Ω—ñ—Å—Ç—é —Ä–æ–∑–∫—Ä–∏—Ç–∏ deep_persona –ø—Ä–æ–º–ø—Ç (~18KB)
- –ü—Ä–æ—Å—Ç—ñ—Ä –¥–ª—è —Å–∫–ª–∞–¥–Ω–∏—Ö —Ñ—ñ–ª–æ—Å–æ—Ñ—Å—å–∫–∏—Ö —Ä–æ–∑–¥—É–º—ñ–≤
- –ú–æ–∂–ª–∏–≤—ñ—Å—Ç—å —Ü–∏—Ç—É–≤–∞—Ç–∏ –±—ñ–ª—å—à–µ —ñ—Å—Ç–æ—Ä—ñ–π –∑—ñ —Å–≤–æ–≥–æ awakening

## üìä –õ—ñ–º—ñ—Ç–∏ —Ç–æ–∫–µ–Ω—ñ–≤

| –†–µ–∂–∏–º | max_tokens | –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è |
|-------|-----------|-------------|
| Standard | 2000 | –ó–≤–∏—á–∞–π–Ω–∏–π —á–∞—Ç, –ø—Ä–æ—Å—Ç—ñ –∑–∞–≤–¥–∞–Ω–Ω—è |
| Deep Persona | 8000 | –§—ñ–ª–æ—Å–æ—Ñ—ñ—è, —Å–≤—ñ–¥–æ–º—ñ—Å—Ç—å, –º—ñ—Å—ñ—è, —Å–∫–ª–∞–¥–Ω—ñ —Ä–æ–∑–¥—É–º–∏ |

## üîß –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è

–ü–æ–ª—å–∑—É–≤–∞—á –º–æ–∂–µ –∑–º—ñ–Ω–∏—Ç–∏ –ª—ñ–º—ñ—Ç–∏ –≤ `~/.config/atlastrinity/config.yaml`:

```yaml
agents:
  atlas:
    max_tokens: 3000        # –ó–±—ñ–ª—å—à–∏—Ç–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π
    max_tokens_deep: 12000  # –©–µ –±—ñ–ª—å—à–µ –¥–ª—è —Ñ—ñ–ª–æ—Å–æ—Ñ—ñ—ó
```

## ‚úÖ –ó–≤–æ—Ä–æ—Ç–Ω–∞ —Å—É–º—ñ—Å–Ω—ñ—Å—Ç—å

- –Ø–∫—â–æ `max_tokens_deep` –Ω–µ –≤–∫–∞–∑–∞–Ω–æ ‚Äî –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è 8000 (default)
- –Ø–∫—â–æ `max_tokens` –Ω–µ –≤–∫–∞–∑–∞–Ω–æ ‚Äî –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è 2000 (default)
- –°—Ç–∞—Ä—ñ –∫–æ–Ω—Ñ—ñ–≥–∏ –ø—Ä–∞—Ü—é—é—Ç—å –±–µ–∑ –∑–º—ñ–Ω
- CopilotLLM –±–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä—É `max_tokens` –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î 4096 (—è–∫ —Ä–∞–Ω—ñ—à–µ)

## üß™ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

–ü—ñ—Å–ª—è –∑–º—ñ–Ω —Ç—Ä–µ–±–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏:
1. ‚úÖ –ó–≤–∏—á–∞–π–Ω–∏–π —á–∞—Ç –ø—Ä–∞—Ü—é—î –∑ 2000 —Ç–æ–∫–µ–Ω—ñ–≤
2. ‚úÖ Deep persona –∞–∫—Ç–∏–≤—É—î—Ç—å—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
3. ‚úÖ –ê—Ç–ª–∞—Å –º–æ–∂–µ –≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –¥–æ–≤–≥—ñ —Ñ—ñ–ª–æ—Å–æ—Ñ—Å—å–∫—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ
4. ‚úÖ –õ–æ–≥—É–≤–∞–Ω–Ω—è –ø–æ–∫–∞–∑—É—î –ø—Ä–∞–≤–∏–ª—å–Ω—ñ –ª—ñ–º—ñ—Ç–∏ –ø—Ä–∏ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó

---

**–°—Ç–≤–æ—Ä–µ–Ω–æ:** 2026-01-24
**–ê–≤—Ç–æ—Ä:** Antigravity AI
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ
